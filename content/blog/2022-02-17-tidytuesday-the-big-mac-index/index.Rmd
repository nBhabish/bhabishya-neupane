---
title: '#TidyTuesday: The Big Mac Index'
author: "Bhabishya Neupane"
date: '2022-02-17'
slug: []
excerpt: Analyzing Big Mac Index and coming up w/ interesting visualization
categories:
- tidytuesday
- data visualization
- data analysis
- ggplot2
tags: []
---

```{r include = FALSE}
library(knitr)
knitr::opts_chunk$set(cache = FALSE, warning = FALSE, message = FALSE, 
                      echo = TRUE, dpi = 300, cache.lazy = FALSE, fig.width = 8,
                      fig.height = 5)
```

### Libraries

Loading my go-to libraries. 

```{r}
# Analysis Pack
library(tidyverse)
library(tidytuesdayR)
library(scales)
library(infer)
library(fuzzyjoin)

# Theming Pack
library(nationalparkcolors)
library(paletteer)

# Styling Pack
library(reactable)
library(showtext)
library(showtextdb)
library(extrafont)
library(extrafontdb)
library(reactable)
library(reactablefmtr)


showtext_auto()
font_add_google("BenchNine", family = "BenchNine")
```

### Data

```{r}
big_mac <- readr::read_csv('https://raw.githubusercontent.com/TheEconomist/big-mac-data/master/output-data/big-mac-full-index.csv') %>% 
  rename(country = name) %>% 
  add_count(country, name = "country_total") %>% 
  arrange(country, date)
```


```{r include = FALSE}
big_mac %>% 
  reactable::reactable()
```


```{r include = FALSE}
big_mac %>% 
  count(country, sort = TRUE) %>% 
  add_count(n, sort = TRUE) %>% 
  reactable(
    columns = list(
      country = colDef(
        cell = color_tiles(., color_by = "nn", colors = c("#A8CDEC","#F6955E","#682C37","#9B6981", "#7887A4","#A89F8E"), box_shadow = TRUE)
      )
    )
  )
```




### Exploratory Data Visualization


```{r}
big_mac %>% 
  filter(country_total == max(country_total)) %>% 
  select(date, local_price, dollar_price, country) %>% 
  pivot_longer(cols = c(local_price, dollar_price), names_to = "price") %>% 
  ggplot(aes(date, value, color = price))+
  geom_line()+
  facet_wrap(~country, scales = "free_y")+
  # scale_y_log10(labels = scales::comma_format())+
  expand_limits(y = 0)+
  scale_color_paletteer_d("nationalparkcolors::Badlands")+
  theme(text = element_text(family = "BenchNine"),
        plot.title = element_text(size = 15),
        legend.position = "top", 
        axis.text.x = element_text(angle = 90, hjust = 1))+
  labs(x = "", 
       y = "Big Mac Price")
```


### Takeaway from this plot

Let's try focusing on countries where the lines crossed. If the dollar price is higher than the local price line, it simply implies that dollar is undervalued compared to the local currency. In other words, dollar has less purchasing power in that particular country.


```{r}
big_mac %>% 
  filter(country_total == max(country_total)) %>% 
  mutate(country = fct_reorder(country, local_price, function(.) last(.)/first(.))) %>% 
  ggplot(aes(date, local_price, color = country))+
  geom_line()+
  expand_limits(y = 0)+
  facet_wrap(~country, scales = "free_y")+
  theme(legend.position = "none")+
  labs(x = "Time",
       y = "Price of Big Max Local Currency", 
       title = "")+
  theme(text = element_text(family = "BenchNine"),
        plot.title = element_text(size = 15))

```



```{r}
big_mac %>% 
  filter(country_total == max(country_total)) %>% 
  group_by(country) %>% 
  summarize(big_mac_inflation = last(local_price)/first(local_price)) %>% 
  arrange(desc(big_mac_inflation)) %>% 
  mutate(country = country %>% fct_reorder(big_mac_inflation)) %>% 
  ggplot(aes(big_mac_inflation, country))+
  geom_col(fill = "#554C6C")+
  scale_x_log10(breaks = c(1, 3, 10, 30, 100))+
  labs(x = "Price of Big Mac (2021)/ Price of Big Mac(2000)", 
       y = "",
       title = "Countries and their Big Mac Inflation between 2000 and 2021",
       caption = "Data Source: The Economist")+
  theme(text = element_text(family = "BenchNine"),
        plot.title = element_text(size = 15))
  
```


```{r}
big_mac %>% 
  filter(country_total == max(country_total)) %>% 
  ggplot(aes(date, dollar_price))+
  geom_line()+
  expand_limits(y = 0)+
  facet_wrap(~country)+
    theme(text = element_text(family = "BenchNine"),
        plot.title = element_text(size = 15))+
  labs(x = "", 
       y = "Big Mac Price in Dollars", 
       title = "Countries and their Big Mac Price in Dollars between 2000 to 2021")
```


### Checking the Math

```{r}
big_mac %>% 
  filter(country_total == max(country_total)) %>% 
  group_by(date) %>% 
  mutate(usd_price = local_price[iso_a3 == "USA"]) %>% 
  mutate(us_gdp    = GDP_dollar[iso_a3 == "USA"]) %>% 
  mutate(big_mac_ex = local_price/usd_price) %>% 
  ungroup() %>% 
  select(date, iso_a3, country, local_price, dollar_ex, usd_price, big_mac_ex, USD_raw) %>% 
  mutate(usd_raw_check = (big_mac_ex-dollar_ex)/dollar_ex) %>% 
  reactable::reactable()
```


```{r}
big_mac %>% 
  filter(country_total == max(country_total)) %>% 
  select(date, country, local_price, dollar_ex, USD_raw, GDP_dollar, USD_adjusted) %>% 
  filter(!is.na(GDP_dollar)) %>% 
  ggplot(aes(date, USD_raw))+
  geom_line()+
  facet_wrap(~country, scales = "free_y")+
  expand_limits(y = 0)
  

```










