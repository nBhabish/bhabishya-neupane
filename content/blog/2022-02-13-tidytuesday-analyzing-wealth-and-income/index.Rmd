---
title: '#TidyTuesday: Analyzing wealth and income'
author: Bhabishya Neupane
date: '2022-02-13'
slug: []
excerpt: Analyzing wealth and income
categories:
  - tidytuesday
  - data visualization
tags: []
---

```{r}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

### Libraries & Data
```{r}
library(tidyverse)
library(tidytuesdayR)
library(scales)
library(ragg)
library(extrafontdb)
library(showtextdb)
library(extrafont)
library(showtext)


tuesdata <- tidytuesdayR::tt_load(2021, week = 7)

showtext_auto()
update_geom_defaults("rect", list(fill = "midnightblue", alpha = 0.8))
theme_set(theme_minimal())
font_add_google("BenchNine", family = "BenchNine")
```

```{r include=FALSE}
lifetime_earn <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/lifetime_earn.csv')
student_debt <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/student_debt.csv')
retirement <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/retirement.csv')
home_owner <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/home_owner.csv')
race_wealth <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/race_wealth.csv')
income_time <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/income_time.csv')
income_limits <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/income_limits.csv')
income_aggregate <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/income_aggregate.csv')
income_distribution <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/income_distribution.csv')
income_mean <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/income_mean.csv')
```


### Exploratory Data Analysis

```{r}

lifetime_earn %>% 
  ggplot(aes(lifetime_earn, race, fill = gender))+
  geom_col(
   position = "dodge"
  )+
  scale_x_continuous(labels = dollar)+
  labs(x = "")+
  scale_fill_brewer(type = "qual")+
  labs(y = "Race",
       title = "Lifetime earnings by race in the United States")+
  theme(text = element_text(family = "BenchNine"))


student_debt %>% 
  ggplot(aes(year, loan_debt_pct, color = race))+
  geom_line()+
  expand_limits(y = 0)+
  scale_y_continuous(labels = scales::percent_format())+
  labs(y = "% of families with student loan debt")+
  scale_color_brewer(type = "qual")+
  theme(text = element_text(family = "BenchNine"))


student_debt %>% 
  ggplot(aes(year, loan_debt, color = race))+
  geom_line()+
  expand_limits(y = 0)+
  scale_y_continuous(labels = scales::dollar_format())+
  labs(y = "Average Loan Debt")+
  scale_color_brewer(type = "qual")+
  labs(y = "", x = "")+
  theme(text = element_text(family = "BenchNine"))

retirement %>% 
  ggplot(aes(year, retirement, color = race))+
  geom_line()+
  expand_limits(y = 0)+
  scale_y_continuous(labels = scales::dollar)+
  labs(x = "", y = "",
       title = "Retirement savings by year in the United States, 1989-2016")+
  theme(text = element_text(family = "BenchNine"))

home_owner %>%
  mutate(race = fct_reorder(race, -home_owner_pct)) %>% 
  ggplot(aes(year, home_owner_pct, color = race))+
  geom_line()+
  expand_limits(y = 0)+
  scale_color_brewer(type = "qual", palette = 2)+
  labs(y = "Home Owner %", 
       x = "", 
       title = "Home Owner Percentage in the United States by Race, 1976-2016")+
  theme(text = element_text(family = "BenchNine"))
```

### Customized Function

```{r}
plot_line <- function(data, column, labels = dollar){
  data %>% 
  mutate(race := fct_reorder(race, - {{ column }}, last)) %>% 
  ggplot(aes(year, {{ column }}, color = race))+
  geom_line()+
  expand_limits(y = 0)+
  scale_y_continuous(labels = labels) +
  scale_color_brewer(type = "qual", palette = 2)
}
```


```{r}

immediate_year <- race_wealth %>% 
  filter(type == "Average") %>% 
  group_by(race) %>% 
  top_n(1, year)
```


```{r}
income_time %>% 
  mutate(percentile = fct_reorder(percentile, -income_family, last)) %>% 
  ggplot(aes(year, income_family, color = percentile))+
  geom_line()+
  expand_limits(y = 0)+
  scale_y_continuous(labels = scales::dollar_format())+
  labs(y = "",
       x = "",
       title = "Family-level income by percentile and year",
       color = "Percentile")+
  theme(text = element_text(family = "BenchNine"))


income_time %>% 
  pivot_wider(names_from = percentile, values_from = income_family) %>%
  ggplot(aes(year, `50th`, ymin = `10th`, ymax = `90th`))+
  geom_line()+
  geom_ribbon(alpha =0.5)+
  expand_limits(y = 0)+
  labs(x = "Year", y = "Family Income (Median with 10th and 90th percentile)")+
  scale_y_continuous(labels = scales::dollar_format())+
  theme(text = element_text(family = "BenchNine"))

```

What does 90th percentile mean?

- 90% of the data or obseravations or values in the table are equal or lower than that score. 

```{r}

race_wealth %>% 
  mutate(race = race %>% fct_reorder(-wealth_family, last)) %>% 
  ggplot(aes(year, wealth_family, color = race))+
  geom_line()+
  facet_wrap(~type, scales = "free_y")+
  scale_y_continuous(labels = scales::dollar_format())+
  scale_color_brewer(type = "qual", palette = 6)+
  labs(y = "", 
       x = "", 
       color = "Race",
       lty   = "Type", 
       title = "Family wealth by Race and Year",
       subtitle = "Measures of central tendency is incorporated via mean and median")+
  theme(text = element_text(family = "BenchNine"))
```


### Why is there a higher average than median? 
- Chances are there might be some extremely rich people who are pulling away the mean. The median is not influenced by those rich people at all. 


### Income Limits

What is a quintile? 

- According to Merrian-Webster, quintile is any of the four values that divide the items of a frequency distribution into five classes with each containing one fifth of the total population. 

```{r}
income_limits %>% 
  # pivot_wider(names_from = income_quintile, values_from = income_dollars) %>% 
  # janitor::clean_names() %>% 
  filter(dollar_type == "2019 Dollars") %>% 
  distinct(race, year, income_quintile, .keep_all = TRUE) %>% 
  mutate(income_quintile = income_quintile %>% as_factor()) %>% 
  mutate(income_quintile_num = as.numeric(income_quintile)) %>% 
  ggplot(aes(year, income_dollars, color = race))+
  facet_wrap(~income_quintile, scales = "free_y")+
  geom_line()+
  labs(y = "Income in 2019 Dollars", 
       x = "", color = "Race")+
  scale_color_brewer(type = "qual", palette = 3)+
  scale_y_continuous(labels = scales::dollar_format())+
  theme(text = element_text(family = "BenchNine"),
        legend.position = "bottom")



income_limits %>% 
  filter(dollar_type == "2019 Dollars") %>% 
  distinct(race, year, income_quintile, .keep_all = TRUE) %>% 
  mutate(income_quintile = income_quintile %>% fct_reorder(-income_dollars, last)) %>% 
  ggplot(aes(year, income_dollars, color = income_quintile))+
  geom_line()+
  facet_wrap(~race)+
  scale_color_brewer(type = "qual", palette = 3)+
  scale_y_continuous(labels = scales::dollar_format())+
  theme(text = element_text(family = "BenchNine"),
        legend.position = "bottom")+
  labs(y = "Income Quintiles", x = "",
       color = "Income Quintile")

```



